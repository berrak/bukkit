#
# Project: <%= projectname %> 
# 
# Top Makefile (recurs down in source directories)
#

#############################################################################
#	 -- EXTERNAL SHELL VARIABLES
#############################################################################

MAKE = /usr/bin/make
QUIET = @

ECHO = /bin/echo
# DATE = /bin/date
# DATEOPT = +%Y%m%d.%H%M
CP = /bin/cp
MKDIR = mkdir -p
TAR = /bin/tar
TAROPT = chof -
GZIP = /bin/gzip
GZIPOPT = -9 -c
# the -f option suppress return status and prevents make to emit an error
ERASEREC = /bin/rm -fr


#############################################################################
#	 -- INTERNAL VARIABLES
#############################################################################

package = <%= projectname %>
version = 1.0
tarname = $(package)
distdir = $(tarname)-$(version)

#############################################################################
#	1 -- MAKE ALL, BUILD, INSTALL, DIST, CLEAN, CLEANALL
#############################################################################

all clean cleanall install build:

	cd <%= sourcename %> && $(MAKE) $@
	cd <%= htmlname %> && $(MAKE) $@


dist: $(distdir).tar.gz


$(distdir).tar.gz : $(distdir)
	$(QUIET) $(TAR) $(TAROPT) $(distdir) | $(GZIP) $(GZIPOPT) > $@
	$(QUIET) $(ERASEREC) $(distdir)
	$(QUIET) $(ECHO) [makefile]: Archive $(distdir).tar.gz created


$(distdir):
	$(QUIET) $(MKDIR) $(distdir)
	$(QUIET) $(CP) makefile $(distdir)
#
	$(QUIET) $(MKDIR) $(distdir)/src
	$(QUIET) $(CP) src/makefile $(distdir)/src/.
	$(QUIET) $(CP) src/*.cbl $(distdir)/src/.
#
	$(QUIET) $(MKDIR) $(distdir)/html
	$(QUIET) $(CP) html/makefile $(distdir)/html/.
	$(QUIET) $(CP) html/*.html $(distdir)/html/.
#
	$(QUIET) $(MKDIR) $(distdir)/build/cgi-bin



#############################################################################
#	2 -- PHONY TARGETS
#############################################################################

.PHONY: all clean cleanall build install dist


